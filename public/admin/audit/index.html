<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Accounting System - Audit Log">
    <title>AUDIT LOG | Accounting System</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="/shared/css/app.css">
    <link rel="stylesheet" href="/shared/css/layout.css">
    <link rel="stylesheet" href="/shared/css/components.css">
    <link rel="stylesheet" href="/shared/css/pages.css">
    <link rel="stylesheet" href="/shared/css/ui.css">
    <link rel="stylesheet" href="audit-log.css">
</head>

<body>
    <div class="app-layout">
        <!-- Sidebar Navigation (loaded dynamically) -->
        <aside class="sidebar">
            <!-- Sidebar content will be loaded by sidebar.js -->
        </aside>

        <!-- Main Content Area -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="page-title">
                    <h1>Activity History</h1>
                    <span class="badge badge-info" id="logCount">Loading...</span>
                </div>
                <div class="top-bar-actions">
                    <!-- Tab Switcher -->
                    <div class="tab-switcher"
                        style="display: flex; border: 1px solid var(--color-border); border-radius: 6px; overflow: hidden; margin-right: 1rem;">
                        <button class="tab-btn active" id="tabSystemActivity"
                            style="padding: 0.5rem 1rem; background: var(--color-primary); color: white; border: none; cursor: pointer; font-weight: 500; font-size: 0.875rem;">System
                            Activity</button>
                        <button class="tab-btn" id="tabCompanyLogs"
                            style="padding: 0.5rem 1rem; background: transparent; color: var(--color-text-secondary); border: none; cursor: pointer; font-weight: 500; font-size: 0.875rem;">Company
                            Logs</button>
                    </div>
                </div>
            </header>

            <!-- Content Section -->
            <div class="content-section">
                <!-- Stats Overview -->
                <div class="stats-grid" id="statsGrid">
                    <div class="stat-card">
                        <div class="stat-label">Total Entries</div>
                        <div class="stat-value" id="statTotal">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Info</div>
                        <div class="stat-value severity-info" id="statInfo">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Warnings</div>
                        <div class="stat-value severity-warning" id="statWarning">-</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Security</div>
                        <div class="stat-value severity-security" id="statSecurity">-</div>
                    </div>
                </div>

                <!-- Filter Bar -->
                <div class="filter-bar">
                    <div class="filter-group" id="companyFilterGroup" style="display: none;">
                        <label>Company:</label>
                        <select class="form-select" id="companySelect" style="min-width: 180px;">
                            <option value="">Select Company</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>From:</label>
                        <input type="date" class="form-input date-input" id="filterFromDate">
                    </div>
                    <div class="filter-group">
                        <label>To:</label>
                        <input type="date" class="form-input date-input" id="filterToDate">
                    </div>
                    <div class="filter-group">
                        <label>Severity:</label>
                        <select class="form-select" id="filterSeverity">
                            <option value="">All</option>
                            <option value="info">Info</option>
                            <option value="warning">Warning</option>
                            <option value="critical">Critical</option>
                            <option value="security">Security</option>
                        </select>
                    </div>
                    <div class="filter-group">
                        <label>Category:</label>
                        <select class="form-select" id="filterCategory">
                            <option value="">All</option>
                            <option value="authentication">Authentication</option>
                            <option value="user_management">User Management</option>
                            <option value="company_management">Company Management</option>
                            <option value="chart_of_accounts">Chart of Accounts</option>
                            <option value="transactions">Transactions</option>
                            <option value="approvals">Approvals</option>
                            <option value="reports">Reports</option>
                            <option value="system">System</option>
                        </select>
                    </div>
                    <button class="btn btn-primary" id="btnApplyFilters">Apply Filters</button>
                    <button class="btn btn-secondary" id="btnClearFilters">Clear</button>
                </div>

                <!-- Audit Log Table -->
                <div class="panel">
                    <div class="table-container">
                        <table class="data-table" id="auditTable">
                            <thead>
                                <tr>
                                    <th>Timestamp</th>
                                    <th>Actor</th>
                                    <th>Activity</th>
                                    <th>Entity</th>
                                    <th>Category</th>
                                    <th>Severity</th>
                                </tr>
                            </thead>
                            <tbody id="auditBody">
                                <tr>
                                    <td colspan="6">
                                        <div class="loading-spinner">Loading audit logs...</div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="pagination-controls">
                        <div class="pagination-info" id="paginationInfo">
                            Showing 0 entries
                        </div>
                        <div class="pagination-buttons">
                            <button class="btn btn-secondary btn-sm" id="btnPrevPage" disabled>Previous</button>
                            <button class="btn btn-secondary btn-sm" id="btnNextPage" disabled>Next</button>
                        </div>
                    </div>
                </div>

                <!-- Empty State -->
                <div class="empty-state" id="emptyState" style="display: none;">
                    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="64"
                        height="64" fill="currentColor">
                        <path
                            d="M8 0a8.2 8.2 0 0 1 .701.031C6.444.095 4.07.77 2.3 2.227c-.606.5-1.169 1.072-1.586 1.675C.313 4.539.066 5.261.009 5.986A8 8 0 1 0 8 0Zm.082 1.541a6.46 6.46 0 0 1 1.68.396 6.5 6.5 0 0 1 4.656 6.218 6.46 6.46 0 0 1-.191 1.55h-2.134c.074-.316.114-.646.118-.984v-.28a3.93 3.93 0 0 0-1.142-2.773.748.748 0 0 1 .067-1.123.75.75 0 0 1 .992.065A5.43 5.43 0 0 1 13.7 7.621v.28c0 .287-.025.57-.075.847h2.059a6.43 6.43 0 0 1-.251 1.198H1.57a6.42 6.42 0 0 1-.25-1.198h2.058a5.05 5.05 0 0 1-.075-.847v-.28c0-.364.036-.724.105-1.077a5.42 5.42 0 0 1 1.397-2.649.75.75 0 0 1 1.059.002.748.748 0 0 1-.002 1.058 3.93 3.93 0 0 0-.962 1.936A3.47 3.47 0 0 0 4.84 7.62v.28c.003.343.045.681.122 1.005H2.8a6.47 6.47 0 0 1-.192-1.542A6.466 6.466 0 0 1 8.082 1.54Z">
                        </path>
                    </svg>
                    <h3>No Audit Logs Found</h3>
                    <p>No audit logs match the current filters or no activities have been recorded yet.</p>
                </div>

                <!-- Select Company Message -->
                <div class="empty-state" id="selectCompanyState" style="display: none;">
                    <svg class="empty-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16" width="64"
                        height="64" fill="currentColor">
                        <path
                            d="M1.75 1h8.5c.966 0 1.75.784 1.75 1.75v5.5A1.75 1.75 0 0 1 10.25 10H7.061l-2.574 2.573A1.458 1.458 0 0 1 2 11.543V10h-.25A1.75 1.75 0 0 1 0 8.25v-5.5C0 1.784.784 1 1.75 1ZM1.5 2.75v5.5c0 .138.112.25.25.25h1a.75.75 0 0 1 .75.75v2.19l2.72-2.72a.749.749 0 0 1 .53-.22h3.5a.25.25 0 0 0 .25-.25v-5.5a.25.25 0 0 0-.25-.25h-8.5a.25.25 0 0 0-.25.25Z">
                        </path>
                    </svg>
                    <h3>Select a Company</h3>
                    <p style="text-align: center;">Choose a company from the dropdown above to view its audit logs.</p>
                </div>
            </div>

            <!-- Footer -->
            <footer class="main-footer">
                <span class="footer-text">ALL ACTIVITIES ARE MONITORED AND LOGGED</span>
            </footer>
        </main>
    </div>

    <!-- Detail Modal -->
    <div class="modal" id="detailModal">
        <div class="modal-backdrop"></div>
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h2 id="modalTitle">
                    <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 16 16"
                        fill="currentColor">
                        <path
                            d="M8 0a8.2 8.2 0 0 1 .701.031C6.444.095 4.07.77 2.3 2.227c-.606.5-1.169 1.072-1.586 1.675C.313 4.539.066 5.261.009 5.986A8 8 0 1 0 8 0Z">
                        </path>
                    </svg>
                    Activity Details
                </h2>
                <button class="modal-close" id="btnCloseModal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="detail-grid">
                    <div class="detail-item">
                        <label>Activity ID</label>
                        <span id="detailId" class="hash-value">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Timestamp</label>
                        <span id="detailTimestamp">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Actor</label>
                        <span id="detailActor">-</span>
                    </div>
                    <div class="detail-item">
                        <label>IP Address</label>
                        <span id="detailIp">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Activity Type</label>
                        <span id="detailActivityType" class="activity-type-cell">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Category</label>
                        <span id="detailCategory">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Entity Type</label>
                        <span id="detailEntityType">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Entity ID</label>
                        <span id="detailEntityId" class="hash-value">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Severity</label>
                        <span id="detailSeverity">-</span>
                    </div>
                    <div class="detail-item">
                        <label>Action</label>
                        <span id="detailAction">-</span>
                    </div>
                </div>

                <div class="detail-section" id="changesSection" style="display: none;">
                    <h3 style="margin: 1rem 0 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary);">Changes
                    </h3>
                    <div id="detailChanges"></div>
                </div>

                <div class="detail-section" id="hashSection" style="margin-top: 1rem;">
                    <h3 style="margin: 0 0 0.5rem; font-size: 0.875rem; color: var(--color-text-secondary);">Integrity
                        Hash</h3>
                    <div class="hash-value" id="detailHash">-</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="btnCloseDetail">Close</button>
            </div>
        </div>
    </div>

    <script src="/shared/js/sidebar.js"></script>
    <script src="/shared/js/components.js"></script>
    <script src="/shared/js/ui.js"></script>
    <script src="/shared/js/api.js"></script>
    <script src="audit-log.js"></script>
</body>

</html>