name: Documentation Validation

on:
  push:
    paths:
      - 'docs/**'
      - 'README.md'
  pull_request:
    paths:
      - 'docs/**'
      - 'README.md'

jobs:
  validate-markdown:
    name: Validate Markdown Files
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Lint Markdown files
        uses: DavidAnson/markdownlint-cli2-action@v14
        with:
          globs: |
            README.md
            docs/**/*.md

      - name: Check for broken links
        uses: gaurav-nelson/github-action-markdown-link-check@v1
        with:
          use-quiet-mode: 'yes'
          config-file: '.github/markdown-link-check-config.json'

  validate-structure:
    name: Validate Documentation Structure
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v6

      - name: Check required documentation files
        run: |
          required_files=(
            "docs/01-architecture/overview.md"
            "docs/01-architecture/bounded-contexts.md"
            "docs/01-architecture/hexagonal-architecture.md"
            "docs/01-architecture/event-catalog.md"
            "docs/01-architecture/technology-decisions.md"
          )

          for file in "${required_files[@]}"; do
            if [ ! -f "$file" ]; then
              echo "Error: Required file $file is missing"
              exit 1
            fi
          done

          echo "All required documentation files exist âœ“"
